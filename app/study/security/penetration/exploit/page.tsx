"use client";
import { useState } from "react";
import Link from "next/link";

export default function PenetrationExploitPage() {
  const [activeTab, setActiveTab] = useState("intro");

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">漏洞利用</h1>
      {/* 标签页导航 */}
      <div className="flex space-x-4 mb-6 border-b overflow-x-auto">
        <button
          onClick={() => setActiveTab("intro")}
          className={`px-4 py-2 font-medium whitespace-nowrap ${
            activeTab === "intro"
              ? "border-b-2 border-blue-500 text-blue-600"
              : "text-gray-500 hover:text-gray-700"
          }`}
        >
          基础概念
        </button>
        <button
          onClick={() => setActiveTab("flow")}
          className={`px-4 py-2 font-medium whitespace-nowrap ${
            activeTab === "flow"
              ? "border-b-2 border-blue-500 text-blue-600"
              : "text-gray-500 hover:text-gray-700"
          }`}
        >
          利用流程
        </button>
        <button
          onClick={() => setActiveTab("tech")}
          className={`px-4 py-2 font-medium whitespace-nowrap ${
            activeTab === "tech"
              ? "border-b-2 border-blue-500 text-blue-600"
              : "text-gray-500 hover:text-gray-700"
          }`}
        >
          常见技术
        </button>
        <button
          onClick={() => setActiveTab("tools")}
          className={`px-4 py-2 font-medium whitespace-nowrap ${
            activeTab === "tools"
              ? "border-b-2 border-blue-500 text-blue-600"
              : "text-gray-500 hover:text-gray-700"
          }`}
        >
          工具与实践
        </button>
      </div>
      {/* 内容区域 */}
      <div className="bg-white rounded-lg shadow-md p-6">
        {activeTab === "intro" && (
          <div className="space-y-6">
            <h3 className="text-xl font-semibold mb-3">漏洞利用基础概念</h3>
            <div className="prose max-w-none">
              <p>
                漏洞利用是指利用目标系统存在的安全漏洞，通过构造特定的攻击载荷，获取系统的未授权访问、执行恶意代码或提升权限等。漏洞利用是渗透测试和真实攻击中的关键环节。
              </p>
              <ul>
                <li>目标：突破系统防护，获取更高权限或敏感数据</li>
                <li>方式：自动化工具、手工构造payload、脚本编写等</li>
                <li>风险：可能导致系统崩溃、数据泄露、权限失控</li>
              </ul>
            </div>
          </div>
        )}
        {activeTab === "flow" && (
          <div className="space-y-6">
            <h3 className="text-xl font-semibold mb-3">漏洞利用流程</h3>
            <div className="prose max-w-none">
              <ol className="list-decimal pl-6">
                <li>信息收集：分析目标系统、服务、应用的详细信息</li>
                <li>漏洞分析：识别可利用的漏洞点，评估可行性</li>
                <li>利用开发：编写或定制exploit代码或payload</li>
                <li>漏洞利用：实际执行攻击，获取shell或提升权限</li>
                <li>权限提升：进一步扩展控制范围，获取更高权限</li>
                <li>痕迹清理：清除日志、隐藏攻击行为</li>
              </ol>
            </div>
            {/* SVG流程图：多形状、分支、icon、渐变、阴影 */}
            <div className="my-8">
              <svg width="900" height="400" viewBox="0 0 900 400" className="w-full">
                <defs>
                  <linearGradient id="exploitGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stopColor="#06b6d4" />
                    <stop offset="100%" stopColor="#6366f1" />
                  </linearGradient>
                  <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                    <feDropShadow dx="0" dy="4" stdDeviation="4" floodColor="#888" />
                  </filter>
                  <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#06b6d4"/>
                  </marker>
                </defs>
                {/* 阶段1：信息收集 */}
                <rect x="60" y="160" width="120" height="60" rx="20" fill="url(#exploitGrad)" filter="url(#shadow)" />
                <text x="120" y="195" textAnchor="middle" fill="#fff" fontSize="18" fontWeight="bold">信息收集</text>
                {/* 阶段2：漏洞分析 */}
                <polygon points="240,190 300,160 360,190 300,220" fill="url(#exploitGrad)" filter="url(#shadow)" />
                <text x="300" y="195" textAnchor="middle" fill="#fff" fontSize="18" fontWeight="bold">漏洞分析</text>
                {/* 阶段3：利用开发 */}
                <ellipse cx="450" cy="190" rx="70" ry="35" fill="url(#exploitGrad)" filter="url(#shadow)" />
                <text x="450" y="195" textAnchor="middle" fill="#fff" fontSize="18" fontWeight="bold">利用开发</text>
                {/* 阶段4：漏洞利用 */}
                <rect x="560" y="160" width="120" height="60" rx="10" fill="url(#exploitGrad)" filter="url(#shadow)" />
                <text x="620" y="195" textAnchor="middle" fill="#fff" fontSize="18" fontWeight="bold">漏洞利用</text>
                {/* 阶段5：权限提升 */}
                <polygon points="740,220 800,190 860,220 800,250" fill="url(#exploitGrad)" filter="url(#shadow)" />
                <text x="800" y="225" textAnchor="middle" fill="#fff" fontSize="18" fontWeight="bold">权限提升</text>
                {/* 箭头 */}
                <path d="M180,190 L240,190" stroke="#06b6d4" strokeWidth="4" markerEnd="url(#arrowhead)" />
                <path d="M360,190 L380,190 Q400,190 430,190" stroke="#06b6d4" strokeWidth="4" markerEnd="url(#arrowhead)" />
                <path d="M520,190 L560,190" stroke="#06b6d4" strokeWidth="4" markerEnd="url(#arrowhead)" />
                <path d="M680,190 Q720,190 740,220" stroke="#06b6d4" strokeWidth="4" markerEnd="url(#arrowhead)" />
                {/* 分支：失败路径 */}
                <path d="M450,225 Q470,250 560,220" stroke="#f59e42" strokeWidth="2" strokeDasharray="6,4" markerEnd="url(#arrowhead)" />
                {/* 图标示例 */}
                <g>
                  {/* 钥匙icon */}
                  <path d="M140 180 a10 10 0 1 0 20 0 a10 10 0 1 0 -20 0 M155 180 l15 0" stroke="#fff" strokeWidth="2" fill="none"/>
                  {/* 炸弹icon */}
                  <circle cx="300" cy="180" r="10" fill="#fff" opacity="0.3"/>
                  <rect x="295" y="170" width="10" height="10" fill="#fff" opacity="0.3"/>
                </g>
              </svg>
            </div>
          </div>
        )}
        {activeTab === "tech" && (
          <div className="space-y-6">
            <h3 className="text-xl font-semibold mb-3">常见漏洞利用技术</h3>
            <div className="prose max-w-none">
              <ul>
                <li><b>缓冲区溢出：</b> 通过溢出覆盖返回地址，执行恶意代码</li>
                <li><b>命令注入：</b> 构造特殊输入，执行系统命令</li>
                <li><b>SQL注入：</b> 利用数据库查询漏洞，获取敏感数据</li>
                <li><b>反序列化利用：</b> 伪造序列化数据，执行任意代码</li>
                <li><b>权限提升：</b> 利用系统或服务漏洞获取更高权限</li>
                <li><b>WebShell上传：</b> 上传恶意脚本，远程控制Web服务器</li>
              </ul>
            </div>
          </div>
        )}
        {activeTab === "tools" && (
          <div className="space-y-6">
            <h3 className="text-xl font-semibold mb-3">漏洞利用工具与实践</h3>
            <div className="prose max-w-none">
              <ul>
                <li><b>Metasploit：</b> 最流行的漏洞利用框架，集成大量exploit和payload</li>
                <li><b>Exploit-DB：</b> 漏洞利用代码数据库，查找公开exploit</li>
                <li><b>MSFvenom：</b> 生成多种payload，配合Metasploit使用</li>
                <li><b>Python/Perl脚本：</b> 编写自定义漏洞利用脚本</li>
                <li><b>免杀工具：</b> 如Veil、Shellter等，绕过杀软检测</li>
              </ul>
              <h4 className="font-semibold mt-4">实践案例</h4>
              <ol className="list-decimal pl-6">
                <li>使用Metasploit对Windows主机进行MS17-010漏洞利用，获取Meterpreter shell</li>
                <li>手工构造SQL注入payload，绕过登录验证，获取管理员权限</li>
                <li>上传WebShell，远程执行命令并提权</li>
              </ol>
            </div>
          </div>
        )}
      </div>
      {/* 底部导航 */}
      <div className="mt-8 flex justify-between">
        <Link
          href="/study/security/penetration/scan"
          className="px-4 py-2 text-blue-600 hover:text-blue-800"
        >
          ← 漏洞扫描
        </Link>
        <Link
          href="/study/security/penetration/post"
          className="px-4 py-2 text-blue-600 hover:text-blue-800"
        >
          后渗透测试 →
        </Link>
      </div>
    </div>
  );
} 